<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agregar Prenda</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: Arial, sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    
    .main-container {
      display: flex;
      height: calc(100vh - 100px);
      gap: 20px;
    }
    
    .form-container {
      flex: 0 0 350px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }
    
    .palette-container {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      height: 100%;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    
    .color-group {
      margin-bottom: 15px;
    }
    
    .group-title {
      font-size: 16px;
      margin-bottom: 10px;
      color: #333;
      font-weight: bold;
      background: #f0f0f0;
      padding: 5px 10px;
      border-radius: 4px;
    }
    
    .tonos-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .color-box {
      width: 30px;
      height: 30px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .color-box:hover {
      transform: scale(1.1);
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    
    .color-selected {
      outline: 3px solid #000;
      transform: scale(1.1);
    }
    
    label {
      display: block;
      margin-bottom: 15px;
      color: #555;
    }
    
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    button {
      width: 100%;
      padding: 12px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-top: 10px;
    }
    
    button:hover {
      background-color: #45a049;
    }
    
    #color_hex {
      background-color: #f9f9f9;
      font-weight: bold;
    }
    
    .prenda-icon-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
      flex-grow: 1;
    }
    
    .prenda-icon {
      width: 150px;
      height: 150px;
      transition: all 0.3s ease;
    }
    
    /* Ajustes para pantallas pequeñas */
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
        height: auto;
      }
      
      .form-container, .palette-container {
        flex: none;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>Registrar Nueva Prenda</h1>
  
  <div class="main-container">
    <div class="form-container">
      <form id="formPrenda">
        <label>Nombre de Prenda:
          <input type="text" id="nombre_prenda" required>
        </label>

        <label>Tipo de Prenda:
          <select id="tipoprenda" required>
            <option value="" disabled selected>Seleccione un tipo</option>
          </select>
        </label>

        <label>Color seleccionado:
          <input type="text" id="color_hex" readonly>
        </label>
        
        <button type="submit">Guardar Prenda</button>
      </form>
    </div>
    
    <div class="palette-container">
      <h2>Paleta de Colores</h2>
      <div id="color_palette"></div>
      
      <div class="prenda-icon-container">
        <svg id="prenda-icon" class="prenda-icon" viewBox="0 0 24 24" fill="currentColor">
          <!-- Icono por defecto (se actualizará) -->
          <path d="M16 21H8a1 1 0 0 1-1-1v-5H5v-2h2V8a3 3 0 0 1 3-3h4a3 3 0 0 1 3 3v5h2v2h-2v5a1 1 0 0 1-1 1zm-4-9v4h2v-4h-2zm0-6h-2a1 1 0 0 0-1 1v5h4V8a1 1 0 0 0-1-1z"/>
        </svg>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000';

    // Configuración de paleta de colores
    const paletteDiv = document.getElementById('color_palette');
    const inputColor = document.getElementById('color_hex');
    const prendaIcon = document.getElementById('prenda-icon');
    let selectedBox = null;

    // Definición de iconos para cada tipo de prenda (versión simplificada con paths combinados)
    const iconosPrendas = {
      1: { // Camisas (nuevo diseño combinado)
        path: "M7 4l5 3 5-3 M7 4l-3 3 2 3v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V10l2-3-3-3 M12 7v12 M10 12h4",
        nombre: "Camisa"
      },
      2: { // Camisetas (nuevo diseño combinado)
        path: "M8 5h8 M8 5l-4 3v4l3 1v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-6l3-1V8l-4-3 M9 5a3 3 0 0 0 6 0",
        nombre: "Camiseta"
      },
      3: { // Pantalones (nuevo diseño combinado)
        path: "M7 3h10l-1 7h-2l1 11h-3l-1.5-7L10 21H7l1-11H6L7 3z M12 10v2",
        nombre: "Pantalón"
      },
      4: { // Zapatos (nuevo diseño combinado)
        path: "M3 16c2 .5 5-1 7-3 1.2 1.8 3.9 3 6 3h3a2 2 0 0 1 2 2v1H2v-2a1 1 0 0 1 1-1z M10 13l-2-2 1-1 2 2 M14 16v-2",
        nombre: "Zapatos"
      }
    };

    // Definición de colores agrupados optimizada
    const coloresAgrupados = [
  {
    grupo: 'Rojos/Rosados',
    tonos: {
      '#8B0000': 'Rojo Oscuro',
      '#CD5C5C': 'Rojo Indio',
      '#FF4500': 'Rojo Naranja',
      '#FF1493': 'Rosa Profundo',
      '#FF69B4': 'Rosa Fuerte',
      '#FFC0CB': 'Rosa'
    }
  },
  {
    grupo: 'Naranjas/Amarillos',
    tonos: {
      '#FF8C00': 'Naranja Oscuro',
      '#FFA500': 'Naranja',
      '#FFD700': 'Oro',
      '#FFFF00': 'Amarillo',
      '#FAFAD2': 'Dorado Claro',
      '#FFFACD': 'Amarillo Limón Claro'
    }
  },
  {
    grupo: 'Verdes',
    tonos: {
      '#006400': 'Verde Oscuro',
      '#228B22': 'Verde Bosque',
      '#556B2F': 'Oliva Oscuro',
      '#8FBC8F': 'Verde Mar',
      '#00FF7F': 'Verde Primavera',
      '#ADFF2F': 'Verde Amarillo'
    }
  },
  {
    grupo: 'Azules/Morados',
    tonos: {
      '#0000FF': 'Azul',
      '#5F9EA0': 'Azul Cadete',
      '#1E90FF': 'Azul Dodger',
      '#800080': 'Púrpura',
      '#9370DB': 'Púrpura Medio',
      '#8A2BE2': 'Violeta Azul'
    }
  },
  {
    grupo: 'Neutros',
    tonos: {
      '#000000': 'Negro',
      '#4B4B4B': 'Gris Carbón',
      '#A9A9A9': 'Gris Oscuro',
      '#D3D3D3': 'Gris Claro',
      '#FFFFFF': 'Blanco',
      '#F5F5F5': 'Blanco Humo'
    }
  }
];


    // Generar la paleta agrupada
    coloresAgrupados.forEach(grupo => {
      const grupoDiv = document.createElement('div');
      grupoDiv.className = 'color-group';
      
      const titulo = document.createElement('h3');
      titulo.className = 'group-title';
      titulo.textContent = grupo.grupo;
      grupoDiv.appendChild(titulo);
      
      const tonosContainer = document.createElement('div');
      tonosContainer.className = 'tonos-container';
      
      for (const hex in grupo.tonos) {
        const box = document.createElement('div');
        box.className = 'color-box';
        box.style.backgroundColor = hex;
        box.title = `${grupo.tonos[hex]} (${hex})`;
        
        box.addEventListener('click', () => {
          inputColor.value = hex;
          if (selectedBox) selectedBox.classList.remove('color-selected');
          box.classList.add('color-selected');
          selectedBox = box;
          actualizarIconoPrenda();
        });
        
        tonosContainer.appendChild(box);
      }
      
      grupoDiv.appendChild(tonosContainer);
      paletteDiv.appendChild(grupoDiv);
    });

    // Función para actualizar el icono de la prenda
    function actualizarIconoPrenda() {
      const tipoPrenda = document.getElementById('tipoprenda').value;
      const color = inputColor.value || '#cccccc';
      
      if (tipoPrenda && iconosPrendas[tipoPrenda]) {
        prendaIcon.innerHTML = `<path d="${iconosPrendas[tipoPrenda].path}"/>`;
      }
      
      prendaIcon.setAttribute('fill', color);
    }

    // Cargar tipos de prenda desde la API
    async function cargarTiposPrenda() {
      try {
        const response = await fetch(`${API_URL}/tipoprenda`);
        if (!response.ok) {
          throw new Error('Error al cargar tipos de prenda');
        }
        const tipos = await response.json();
        const select = document.getElementById('tipoprenda');
        
        tipos.forEach(tipo => {
          const option = document.createElement('option');
          option.value = tipo.tipoprenda_id;
          option.textContent = tipo.tipo;
          select.appendChild(option);
        });

        // Escuchar cambios en el tipo de prenda
        select.addEventListener('change', actualizarIconoPrenda);
        
      } catch (error) {
        console.error('Error:', error);
        alert('No se pudieron cargar los tipos de prenda');
      }
    }

    // Enviar el formulario
    document.getElementById('formPrenda').addEventListener('submit', async e => {
      e.preventDefault();
      
      try {
        const prenda = {
          id_usuario: 1,
          nombre_prenda: document.getElementById('nombre_prenda').value,
          color_hex: document.getElementById('color_hex').value,
          tipo_prenda: document.getElementById('tipoprenda').value
        };

        console.log('Enviando:', prenda);

        const response = await fetch(`${API_URL}/prendas`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(prenda)
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.message || 'Error al guardar');
        }

        alert('Prenda guardada correctamente');
        document.getElementById('formPrenda').reset();
        if (selectedBox) selectedBox.classList.remove('color-selected');
        prendaIcon.setAttribute('fill', '#cccccc'); // Resetear color del icono
        
      } catch (err) {
        console.error('Error:', err);
        alert(err.message || 'Error al conectar con el servidor');
      }
    });

    // Inicializar
    cargarTiposPrenda();
  </script>
</body>
</html>